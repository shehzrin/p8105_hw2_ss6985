---
title: "P8105 Homework 2"
output: github_document
---

```{r setup, echo = FALSE, message = FALSE}
library(tidyverse)
library(readxl)
```

## Problem 1 

Import data, clean data, handle missing data, select data, mutate data:   
```{r}
subway_df = 
  read_csv("NYC_Transit_Subway_Entrance_And_Exit_Data.csv", na = c("NA",".","")) |>
  janitor::clean_names() |>
  select(line:entry, vending, ada) |>
  mutate(
    entry = case_match(
      entry,
      "YES" ~ TRUE,
      "NO" ~ FALSE
    )
  )
```

### Description of Dataset: 
The NYC Transit Subway dataset contains information about subway station entrances and exits in New York City. The data has been **imported** and the column names have been **cleaned** to be in a common standard format (e.g., through underscores for spaces/lowercase consistency). I **handled missing values** by converting "NA", ".", and empty strings to NA. I **selected** specific columns/variables that are relevant for further analysis, including the variables **line** (subway line), **station_name** (name of the station), **station_latitude** and **station_longitude** (geographic coordinates of the station), **routes served** (up to 11 routes per station), entrance_type (type of entrance, e.g., stair, elevator, etc.), **entry** (whether the entrance allows entry), **vending** (whether there are vending machines at the entrance), and **ada** (whether the station is ADA compliant). The entry variable was converted from a character ("YES"/"NO") to a logical variable (TRUE for "YES", FALSE for "NO"). The resulting dataset has **`r nrow(subway_df)` rows** and **`r ncol(subway_df)` columns**. The data is **not tidy**, considering there are several columns for each route number, for a total of 11 routes/columns for routes served.

### Questions About Data:
There are **`r nrow(distinct(subway_df, line, station_name))`** distinct stations. 

```{r }
ada_compliant_stations = subway_df |>
  filter(ada == TRUE) |> 
  distinct(line, station_name) |> 
  nrow()

ada_compliant_stations
```
There are **84** stations that are ADA compliant. 

```{r}
no_vending_entry = subway_df |>
  filter(vending == "NO", entry == TRUE) |>
  nrow()

no_vending_entry
```
There are 69 station entrances/exits without vending that allow entrance.  

```{r}
no_vending = subway_df |>
  filter(vending == "NO")|>
  nrow()

no_vending
```
There are 183 station entrances/exits without vending. **69/183 or 37.70%** of station entrances/exits without vending allow entrance. 

### Reformatting Data: 
```{r}
subway_long_df = 
  subway_df |>
  gather(key = route_number, value = route_name, route1:route11) |>
  separate(route_number, into = c("route_str", "route_number"), sep = 5) |>
  select(-route_str)

distinct_a_train_stations = subway_long_df |>
  filter(route_name == "A") |> 
  distinct(line, station_name) |> 
  nrow()

distinct_a_train_stations
```
**60** distinct stations serve the A train. 

```{r}
ada_compliant_a_train_stations = subway_long_df |>
  filter(route_name == "A", ada == TRUE) |> 
  distinct(line, station_name) |> 
  nrow()

ada_compliant_a_train_stations
```
**17** of the stations that serve the A train are ADA compliant. 


## Problem 2

Read and clean the Mr. Trash Wheel sheet: 
```{r}
mr_trashwheel_df = 
  read_excel("202309 Trash Wheel Collection Data.xlsx", 
             na = c("NA",".",""), 
             sheet = "Mr. Trash Wheel", 
             range = "A2:N586", 
             col_names = TRUE) |>
  janitor::clean_names() |>
  filter(!is.na(dumpster)) |>
  mutate(
    sports_balls = as.integer(round(sports_balls)), 
    year = as.integer(year),
    trash_wheel = "Mr. Trash Wheel"
    )
```

Read and clean the Professor Trash Wheel sheet & the Gwynnda Trash Wheel sheet:
```{r}
professor_trashwheel_df = 
  read_excel("202309 Trash Wheel Collection Data.xlsx", 
             na = c("NA",".",""), 
             sheet = "Professor Trash Wheel", 
             range = "A2:M108", 
             col_names = TRUE) |>
  janitor::clean_names() |>
  filter(!is.na(dumpster)) |>
  mutate(
    year = as.integer(year),
    trash_wheel = "Professor Trash Wheel"
    )

gwynnda_trashwheel_df = 
  read_excel("202309 Trash Wheel Collection Data.xlsx", 
             na = c("NA",".",""), 
             sheet = "Gwynnda Trash Wheel", 
             range = "A2:L157", 
             col_names = TRUE) |>
  janitor::clean_names() |>
  filter(!is.na(dumpster)) |>
  mutate(
    year = as.integer(year),
    trash_wheel = "Gwynnda Trash Wheel"
    )
```

Combining datasets:
```{r}
trashwheel_df = 
  bind_rows(mr_trashwheel_df, professor_trashwheel_df, gwynnda_trashwheel_df) |>
  janitor::clean_names() 
```

### About Combined Data: 
I imported 3 datasets that each provided information on a single vessel (Mr.Trash Wheel, Professor Trash Wheel, or Gwynnda Trash Wheel) that removes trash. The **variables** included for each vessel/dataset were dumpster number, month, year, date, weight (tons), volume (cubic yards), plastic bottles, polystyrene, cigarette buds, glass bottles (not included in Gwynnda Trash Wheel dataset), plastic bags, wrappers, sports balls (not included in Professor Trash Wheel dataset or Gwynnda Trash Wheel dataset) and homes powered. After cleaning, organizing, and combining the data, the combined dataset contains information from the three vessels (Mr. Trash Wheel, Professor Trash Wheel, and Gwynnda) with a total of **`r nrow(trashwheel_df)` observations**. The resulting dataset has **`r nrow(trashwheel_df)` rows** and **`r ncol(trashwheel_df)` columns**. Each observation represents a specific dumpster collection event, with key variables including the weight of trash collected (in tons), the number of plastic bottles collected, or the number of cigarette butts removed from the water. 
```{r, echo = FALSE, message = FALSE}
professor_weight_sum = 
  sum(
    with(trashwheel_df, 
         weight_tons[trash_wheel == "Professor Trash Wheel"]), 
    na.rm = TRUE
    )
gwynnda_cig_butts_june = 
  sum(
    with(trashwheel_df, 
         cigarette_butts[trash_wheel == "Gwynnda Trash Wheel" & year == 2022 & month == "June"]), 
    na.rm = TRUE
    )
```
Professor Trash Wheel collected a total of **`r professor_weight_sum` tons of trash**. In June 2022, Gwynnda removed **`r gwynnda_cig_butts_june` cigarette butts from the water**.


## Problem 3


